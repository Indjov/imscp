server {
    server_name {BASE_SERVER_VHOST};

    listen {BASE_SERVER_IP}:{BASE_SERVER_VHOST_HTTPS_PORT};
    # SECTION IPv6 BEGIN.
    listen [::]:{BASE_SERVER_VHOST_HTTPS_PORT} default ipv6only=on;
    # SECTION IPv6 END.

    ssl on;
    ssl_certificate {CONF_DIR}/{BASE_SERVER_VHOST}.pem;
    ssl_certificate_key {CONF_DIR}/{BASE_SERVER_VHOST}.pem;

    ssl_session_cache shared:SSL:50m;
    ssl_session_timeout 1d;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS;
    ssl_prefer_server_ciphers on;

    root {WEB_DIR}/public;
    index index.php index.html;

    location /errors {
        alias {WEB_DIR}/public/errordocs;
    }

    error_page 401 /errors/401.html;
    error_page 403 /errors/403.html;
    error_page 404 /errors/404.html;
    error_page 497 https://$host:$server_port$request_uri;
    error_page 500 /errors/500.html;
    error_page 503 /errors/503.html;

    # Forbid direct access to /tools directory
    location /tools/ {
        return 403;
    }

    location /ispLogos {
        root {WEB_DIR}/data/persistent;
        expires 30d;
    }

    location ~ ^/themes/(.*)/assets {
        root {WEB_DIR};
        expires 30d;
    }

    location ~ ^/(.*)/themes/(.*)/assets {
        root /var/www/imscp/gui/plugins;
        expires 30d;
    }

    location / {
        try_files $uri $uri/ /plugins.php$is_args$args;
    }

    location ~ \.php$ {
        try_files $uri $uri/ /plugins.php$is_args$args;
        include imscp_fastcgi.conf;
    }

    # SECTION custom BEGIN.
    # SECTION custom END.
}
